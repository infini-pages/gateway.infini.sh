<!doctype html><html lang=en><head><meta name=generator content="Hugo 0.79.1"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Performance Test #  You are advised to use the Elasticsearch-dedicated benchmark tool Loadgen to test the gateway performance.
Highlights of Loadgen:
 Robust performance Lightweight and dependency-free Random selection of template-based parameters High concurrency Balanced traffic control at the benchmark end   Download URL: http://release.infinilabs.com/loadgen/
 Loadgen #  Loadgen is easy to use. After the tool is downloaded and decompressed, two files are obtained: one executable program and one configuration file loadgen."><meta name=theme-color content="#FFFFFF"><meta property="og:title" content="Performance Test"><meta property="og:description" content="Performance Test #  You are advised to use the Elasticsearch-dedicated benchmark tool Loadgen to test the gateway performance.
Highlights of Loadgen:
 Robust performance Lightweight and dependency-free Random selection of template-based parameters High concurrency Balanced traffic control at the benchmark end   Download URL: http://release.infinilabs.com/loadgen/
 Loadgen #  Loadgen is easy to use. After the tool is downloaded and decompressed, two files are obtained: one executable program and one configuration file loadgen."><meta property="og:type" content="article"><meta property="og:url" content="/docs/getting-started/benchmark/"><title>Performance Test | INFINI Gateway</title><link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png type=image/x-icon><link rel=alternate hreflang=zh href=/zh/docs/getting-started/benchmark/ title=性能测试><link rel=stylesheet href=/book.min.86778a3f4df1b5b61556a975dd0ee3bd2c03aeee5a2e203fb93ecbd71224869e.css integrity="sha256-hneKP03xtbYVVql13Q7jvSwDru5aLiA/uT7L1xIkhp4="><script defer src=/en.search.min.35ecdbc4b004fe04886dc86c3cb0d729eab3c74bdb861a2e8df23ce8d2242cc2.js integrity="sha256-NezbxLAE/gSIbchsPLDXKeqzx0vbhhoujfI86NIkLMI="></script><script defer src=/js/jquery-2.x.min.js></script><script defer src=/js/doc.js></script></head><body><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><nav><h2 class=book-brand><a href=/><img src=/img/logo-en.svg alt=Logo></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=/docs/overview/>Overview</a><ul></ul></li><li><input type=checkbox id=section-f1b7c1b2e5dd43526e77637c475d35b8 class=toggle checked>
<label for=section-f1b7c1b2e5dd43526e77637c475d35b8 class="flex justify-between"><a>Quick Start</a>
<span>▾</span></label><ul><li><a href=/docs/getting-started/install/>Installing the Gateway</a></li><li><a href=/docs/getting-started/configuration/>Configuring the Gateway</a></li><li><a href=/docs/getting-started/docker/>Container Deployment</a></li><li><a href=/docs/getting-started/optimization/>System Optimization</a></li><li><a href=/docs/getting-started/benchmark/ class=active>Performance Test</a></li></ul></li><li><input type=checkbox id=section-fb088f8a9be33f7f260ad2b140bb7bdc class=toggle>
<label for=section-fb088f8a9be33f7f260ad2b140bb7bdc class="flex justify-between"><a>Reference</a>
<span>▾</span></label><ul><li><a href=/docs/references/entry/>Service Entry</a></li><li><a href=/docs/references/router/>Service Router</a></li><li><a href=/docs/references/flow/>Handling Flow</a></li><li><a href=/docs/references/elasticsearch/>Elasticsearch</a></li><li><a href=/docs/references/context/>Request Context</a></li><li><input type=checkbox id=section-a53d1bd91095fa28aef70cee327a5121 class=toggle>
<label for=section-a53d1bd91095fa28aef70cee327a5121 class="flex justify-between"><a href=/docs/references/filters/>Online Filter</a>
<span>▾</span></label><ul><li><a href=/docs/references/filters/echo/>echo</a></li><li><a href=/docs/references/filters/basic_auth/>basic_auth</a></li><li><a href=/docs/references/filters/bulk_request_mutate/>bulk_request_mutate</a></li><li><a href=/docs/references/filters/bulk_reshuffle/>bulk_reshuffle</a></li><li><a href=/docs/references/filters/bulk_response_process/>bulk_response_process</a></li><li><a href=/docs/references/filters/cache/>cache</a></li><li><a href=/docs/references/filters/clone/>clone</a></li><li><a href=/docs/references/filters/context_filter/>context_filter</a></li><li><a href=/docs/references/filters/context_limiter/>context_limiter</a></li><li><a href=/docs/references/filters/context_regex_replace/>context_regex_replace</a></li><li><a href=/docs/references/filters/date_range_precision_tuning/>date_range_precision_tuning</a></li><li><a href=/docs/references/filters/drop/>drop</a></li><li><a href=/docs/references/filters/dump/>dump</a></li><li><a href=/docs/references/filters/elasticsearch/>elasticsearch</a></li><li><a href=/docs/references/filters/elasticsearch_health_check/>elasticsearch_health_check</a></li><li><a href=/docs/references/filters/flow/>flow</a></li><li><a href=/docs/references/filters/http/>http</a></li><li><a href=/docs/references/filters/ldap_auth/>ldap_auth</a></li><li><a href=/docs/references/filters/logging/>logging</a></li><li><a href=/docs/references/filters/queue/>queue</a></li><li><a href=/docs/references/filters/ratio/>ratio</a></li><li><a href=/docs/references/filters/record/>record</a></li><li><a href=/docs/references/filters/redis_pubsub/>redis_pubsub</a></li><li><a href=/docs/references/filters/request_api_key_filter/>request_api_key_filter</a></li><li><a href=/docs/references/filters/request_api_key_limiter/>request_api_key_limiter</a></li><li><a href=/docs/references/filters/request_body_json_del/>request_body_json_del</a></li><li><a href=/docs/references/filters/request_body_json_set/>request_body_json_set</a></li><li><a href=/docs/references/filters/request_body_regex_replace/>request_body_regex_replace</a></li><li><a href=/docs/references/filters/request_client_ip_filter/>request_client_ip_filter</a></li><li><a href=/docs/references/filters/request_client_ip_limiter/>request_client_ip_limiter</a></li><li><a href=/docs/references/filters/request_header_filter/>request_header_filter</a></li><li><a href=/docs/references/filters/request_host_filter/>request_host_filter</a></li><li><a href=/docs/references/filters/request_host_limiter/>request_host_limiter</a></li><li><a href=/docs/references/filters/request_method_filter/>request_method_filter</a></li><li><a href=/docs/references/filters/request_path_filter/>request_path_filter</a></li><li><a href=/docs/references/filters/request_path_limiter/>request_path_limiter</a></li><li><a href=/docs/references/filters/request_user_filter/>request_user_filter</a></li><li><a href=/docs/references/filters/request_user_limiter/>request_user_limiter</a></li><li><a href=/docs/references/filters/response_body_regex_replace/>response_body_regex_replace</a></li><li><a href=/docs/references/filters/response_header_filter/>response_header_filter</a></li><li><a href=/docs/references/filters/response_header_format/>response_header_format</a></li><li><a href=/docs/references/filters/response_status_filter/>response_status_filter</a></li><li><a href=/docs/references/filters/retry_limiter/>retry_limiter</a></li><li><a href=/docs/references/filters/sample/>sample</a></li><li><a href=/docs/references/filters/set_basic_auth/>set_basic_auth</a></li><li><a href=/docs/references/filters/set_context/>set_context</a></li><li><a href=/docs/references/filters/set_hostname/>set_hostname</a></li><li><a href=/docs/references/filters/set_request_header/>set_request_header</a></li><li><a href=/docs/references/filters/set_request_query_args/>set_request_query_args</a></li><li><a href=/docs/references/filters/set_response/>set_response</a></li><li><a href=/docs/references/filters/set_response_header/>set_response_header</a></li><li><a href=/docs/references/filters/sleep/>sleep</a></li><li><a href=/docs/references/filters/switch/>switch</a></li><li><a href=/docs/references/filters/translog/>translog</a></li></ul></li><li><input type=checkbox id=section-82db29a871579194764c352cfff582f2 class=toggle>
<label for=section-82db29a871579194764c352cfff582f2 class="flex justify-between"><a href=/docs/references/processors/>Offline Processor</a>
<span>▾</span></label><ul><li><a href=/docs/references/processors/bulk_indexing/>bulk_indexing</a></li><li><a href=/docs/references/processors/dag/>dag</a></li><li><a href=/docs/references/processors/dump_hash/>dump_hash</a></li><li><a href=/docs/references/processors/flow_runner/>flow_runner</a></li><li><a href=/docs/references/processors/index_diff/>index_diff</a></li><li><a href=/docs/references/processors/json_indexing/>json_indexing</a></li><li><a href=/docs/references/processors/queue_consumer/>queue_consumer</a></li><li><a href=/docs/references/processors/replay/>replay</a></li></ul></li><li><input type=checkbox id=section-3de6688eceb9f20db2f0270adccf76e2 class=toggle>
<label for=section-3de6688eceb9f20db2f0270adccf76e2 class="flex justify-between"><a>Functional Component</a>
<span>▾</span></label><ul><li><a href=/docs/references/modules/floating_ip/>Floating IP</a></li><li><a href=/docs/references/modules/force_merge/>Index Segment Merging</a></li></ul></li><li><a href=/docs/references/config/>Other Configuration</a></li></ul></li><li><input type=checkbox id=section-75a1b849ec817b105e0397971f02e977 class=toggle>
<label for=section-75a1b849ec817b105e0397971f02e977 class="flex justify-between"><a>Development</a>
<span>▾</span></label><ul><li><input type=checkbox id=section-67ac850f314cddf19527a42089315d2f class=toggle>
<label for=section-67ac850f314cddf19527a42089315d2f class="flex justify-between"><a>API Manual</a>
<span>▾</span></label><ul></ul></li><li><input type=checkbox id=section-8c2a68d691ef9d9cc23e692c13acbab6 class=toggle>
<label for=section-8c2a68d691ef9d9cc23e692c13acbab6 class="flex justify-between"><a>Plug-in Development</a>
<span>▾</span></label><ul></ul></li></ul></li><li><input type=checkbox id=section-391bcaab6cc03bd87e3373752bfd390e class=toggle>
<label for=section-391bcaab6cc03bd87e3373752bfd390e class="flex justify-between"><a>Tutorials</a>
<span>▾</span></label><ul><li><a href=/docs/tutorial/log4j2_filtering/>Apache Log4j Vulnerability Processing</a></li><li><a href=/docs/tutorial/online_query_rewrite/>Online Query Repair</a></li><li><a href=/docs/tutorial/request-logging/>Query Request Log Analysis</a></li><li><a href=/docs/tutorial/index_diff/>Index Document-Level Difference Contrast</a></li><li><a href=/docs/tutorial/proxy_kibana/>Adding a Proxy and Basic Security for Kibana</a></li><li><a href=/docs/tutorial/fix_count_in_search_response/>Compatible with the Count Structure of Query Response Results of Different Elasticsearch Versions</a></li><li><a href=/docs/tutorial/es-hadoop_integration/>Integration with Elasticsearch-Hadoop</a></li></ul></li><li><input type=checkbox id=section-7e4e95606453deb85437b78d9c3f2d72 class=toggle>
<label for=section-7e4e95606453deb85437b78d9c3f2d72 class="flex justify-between"><a href=/docs/user-cases/>User Cases</a>
<span>▾</span></label><ul><li><a href=/docs/user-cases/stories/indexing_speedup_for_big_index_rebuild/>How an Insurance Group Improved the Indexing Speed by 200x Times</a></li><li><a href=/docs/user-cases/stories/a_cross_region_cluster_access_locality/>Nearest Cluster Access Across Two Cloud Providers</a></li></ul></li><li><a href=/docs/troubleshooting/>FAQs</a><ul></ul></li><li><a href=/docs/release-notes/>Release Notes</a><ul></ul></li><li><a href=/docs/resources/>Other Resources</a><ul></ul></li></ul><div class=heading><select class=version-selector>
<option value>master (latest)</option>
<option value=v1.5.0>v1.5.x</option>
<option value=v1.4.0>v1.4.x</option>
<option value=v1.3.0>v1.3.x</option></select></div><ul><a class=download-btn href=https://release.infinilabs.com/>Download</a></ul></nav><script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Performance Test</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#performance-test>Performance Test</a><ul><li><a href=#loadgen>Loadgen</a><ul><li><a href=#use-of-variables>Use of Variables</a></li><li><a href=#request-definition>Request Definition</a></li><li><a href=#cli-parameters>CLI Parameters</a></li><li><a href=#benchmark-test>Benchmark Test</a></li><li><a href=#simulating-bulk-ingestion>Simulating Bulk Ingestion</a></li><li><a href=#limiting-the-client-workload>Limiting the Client Workload</a></li><li><a href=#limiting-the-total-number-of-requests>Limiting the Total Number of Requests</a></li><li><a href=#using-auto-incremental-ids-to-ensure-the-document-sequence>Using Auto Incremental IDs to Ensure the Document Sequence</a></li></ul></li></ul></li></ul></nav></aside></header><article class=markdown><h1 id=performance-test>Performance Test
<a class=anchor href=#performance-test>#</a></h1><p>You are advised to use the Elasticsearch-dedicated benchmark tool <code>Loadgen</code> to test the gateway performance.</p><p>Highlights of Loadgen:</p><ul><li>Robust performance</li><li>Lightweight and dependency-free</li><li>Random selection of template-based parameters</li><li>High concurrency</li><li>Balanced traffic control at the benchmark end</li></ul><blockquote><p>Download URL:
<a href=http://release.infinilabs.com/loadgen/>http://release.infinilabs.com/loadgen/</a></p></blockquote><h2 id=loadgen>Loadgen
<a class=anchor href=#loadgen>#</a></h2><p>Loadgen is easy to use. After the tool is downloaded and decompressed, two files are obtained: one executable program and one configuration file <code>loadgen.yml</code>. An example of the configuration file is as follows:</p><pre><code>variables:
  - name: ip
    type: file
    path: test/ip.txt
  - name: user
    type: file
    path: test/user.txt
  - name: id
    type: sequence
  - name: uuid
    type: uuid
  - name: now_local
    type: now_local
  - name: now_utc
    type: now_utc
  - name: now_unix
    type: now_unix
requests:
  - request:
      has_variable: true
      method: GET
      basic_auth:
        username: elastic
        password: pass
      url: http://localhost:8000/medcl/_search
      body: '{  &quot;query&quot;: {&quot;match&quot;: {    &quot;name&quot;: &quot;$[[user]]&quot;  }}}'
</code></pre><h3 id=use-of-variables>Use of Variables
<a class=anchor href=#use-of-variables>#</a></h3><p>In the above configuration, <code>variables</code> is used to define variable parameters and variables are identified by <code>name</code>. In a constructed request, <code>$[[Variable name]]</code> can be used to access the value of the variable. Supported variable types are as follows:</p><table><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>file</td><td>External variable parameter of the file type</td></tr><tr><td>sequence</td><td>Variable of the auto incremental numeric type</td></tr><tr><td>uuid</td><td>Variable of the UUID character type</td></tr><tr><td>now_local</td><td>Current time and local time zone</td></tr><tr><td>now_utc</td><td>Current time and UTC time zone</td></tr><tr><td>now_unix</td><td>Current time and Unix timestamp</td></tr></tbody></table><p>Variable parameters of the <code>file</code> type are loaded from an external text file. One variable parameter occupies one line. When one variable of the file type is accessed, one variable value is taken randomly. An example of the variable format is as follows:</p><pre><code>➜  loadgen git:(master) ✗ cat test/user.txt 
medcl
elastic
</code></pre><h3 id=request-definition>Request Definition
<a class=anchor href=#request-definition>#</a></h3><p>The <code>requests</code> node is used to set requests to be executed by Loadgen in sequence. Loadgen supports fixed-parameter requests (when <code>has_variable</code> is set to <code>true</code>) and requests constructed using template-based variable parameters. The following is an example of a common query request.</p><pre><code>requests:
  - request:
      has_variable: true
      method: GET
      basic_auth:
        username: elastic
        password: pass
      url: http://localhost:8000/medcl/_search?q=name:$[[user]]
</code></pre><p>In the above query, Loadgen conducts queries based on the <code>medcl</code> index and executes one query based on the <code>name</code> field. The value of each request is from the random variable <code>user</code>.</p><h3 id=cli-parameters>CLI Parameters
<a class=anchor href=#cli-parameters>#</a></h3><p>Loadgen cyclically executes requests defined in the configuration file. By default, Loadgen runs for <code>5s</code> and then automatically exits. If you want to prolong the running time or increase the concurrency, you can set the tool&rsquo;s startup parameters. The help commands are as follows:</p><pre><code>➜  loadgen git:(master) ✗ ./bin/loadgen --help
Usage of ./bin/loadgen:
  -c int
    	Number of concurrent threads (default 1)
  -compress
    	Compress requests with gzip
  -config string
    	the location of config file, default: loadgen.yml (default &quot;loadgen.yml&quot;)
  -cpu int
    	the number of CPUs to use (default -1)
  -cpuprofile string
    	write cpu profile to this file
  -d int
    	Duration of tests in seconds (default 5)
  -daemon
    	run in background as daemon
  -debug
    	run in debug mode, loadgen will quit with panic error
  -l int
    	Limit total requests (default -1)
  -log string
    	the log level,options:trace,debug,info,warn,error (default &quot;info&quot;)
  -memprofile string
    	write memory profile to this file
  -pidfile string
    	pidfile path (only for daemon mode)
  -pprof string
    	enable and setup pprof/expvar service, eg: localhost:6060 , the endpoint will be: http://localhost:6060/debug/pprof/ and http://localhost:6060/debug/vars
  -r int
    	Max requests per second (fixed QPS) (default -1)
  -v	version
</code></pre><h3 id=benchmark-test>Benchmark Test
<a class=anchor href=#benchmark-test>#</a></h3><p>Run Loadgen to perform the benchmark test as follows:</p><pre><code>➜  loadgen git:(master) ✗ ./bin/loadgen -d 30 -c 100 -compress
   __   ___  _      ___  ___   __    __
  / /  /___\/_\    /   \/ _ \ /__\/\ \ \
 / /  //  ///_\\  / /\ / /_\//_\ /  \/ /
/ /__/ \_//  _  \/ /_// /_\\//__/ /\  /
\____|___/\_/ \_/___,'\____/\__/\_\ \/

[LOADGEN] A http load generator and testing suit.
[LOADGEN] 1.0.0_SNAPSHOT, 83f2cb9, Sun Jul 4 13:52:42 2021 +0800, medcl, support single item in dict files
[07-19 16:15:00] [INF] [instance.go:24] workspace: data/loadgen/nodes/0
[07-19 16:15:00] [INF] [loader.go:312] warmup started
[07-19 16:15:00] [INF] [app.go:306] loadgen now started.
[07-19 16:15:00] [INF] [loader.go:316] [GET] http://localhost:8000/medcl/_search
[07-19 16:15:00] [INF] [loader.go:317] status: 200,&lt;nil&gt;,{&quot;took&quot;:1,&quot;timed_out&quot;:false,&quot;_shards&quot;:{&quot;total&quot;:1,&quot;successful&quot;:1,&quot;skipped&quot;:0,&quot;failed&quot;:0},&quot;hits&quot;:{&quot;total&quot;:{&quot;value&quot;:0,&quot;relation&quot;:&quot;eq&quot;},&quot;max_score&quot;:null,&quot;hits&quot;:[]}}
[07-19 16:15:00] [INF] [loader.go:316] [GET] http://localhost:8000/medcl/_search?q=name:medcl
[07-19 16:15:00] [INF] [loader.go:317] status: 200,&lt;nil&gt;,{&quot;took&quot;:1,&quot;timed_out&quot;:false,&quot;_shards&quot;:{&quot;total&quot;:1,&quot;successful&quot;:1,&quot;skipped&quot;:0,&quot;failed&quot;:0},&quot;hits&quot;:{&quot;total&quot;:{&quot;value&quot;:0,&quot;relation&quot;:&quot;eq&quot;},&quot;max_score&quot;:null,&quot;hits&quot;:[]}}
[07-19 16:15:01] [INF] [loader.go:316] [POST] http://localhost:8000/_bulk
[07-19 16:15:01] [INF] [loader.go:317] status: 200,&lt;nil&gt;,{&quot;took&quot;:120,&quot;errors&quot;:false,&quot;items&quot;:[{&quot;index&quot;:{&quot;_index&quot;:&quot;medcl-y4&quot;,&quot;_type&quot;:&quot;doc&quot;,&quot;_id&quot;:&quot;c3qj9123r0okahraiej0&quot;,&quot;_version&quot;:1,&quot;result&quot;:&quot;created&quot;,&quot;_shards&quot;:{&quot;total&quot;:2,&quot;successful&quot;:1,&quot;failed&quot;:0},&quot;_seq_no&quot;:5735852,&quot;_primary_term&quot;:3,&quot;status&quot;:201}}]}
[07-19 16:15:01] [INF] [loader.go:325] warmup finished

5253 requests in 32.756483336s, 524.61KB sent, 2.49MB received

[Loadgen Client Metrics]
Requests/sec:		175.10
Request Traffic/sec:	17.49KB
Total Transfer/sec:	102.34KB
Avg Req Time:		5.711022ms
Fastest Request:	440.448µs
Slowest Request:	3.624302658s
Number of Errors:	0
Number of Invalid:	0
Status 200:		5253

[Estimated Server Metrics]
Requests/sec:		160.37
Transfer/sec:		93.73KB
Avg Req Time:		623.576686ms
</code></pre><p>Loadgen executes all requests once to warm up before the formal benchmark test. If an error occurs, a prompt is displayed, asking you whether to continue. The warm-up request results are also output to the terminal. After execution, an execution summary is output.</p><blockquote><p>The final results of Loadgen are the cumulative statistics after all requests are executed, and they may be inaccurate. You are advised to start the Kibana dashboard to check all operating indicators of Elasticsearch in real time.</p></blockquote><h3 id=simulating-bulk-ingestion>Simulating Bulk Ingestion
<a class=anchor href=#simulating-bulk-ingestion>#</a></h3><p>It is very easy to use Loadgen to simulate bulk ingestion. Configure one index operation in the request body and then use the <code>body_repeat_times</code> parameter to randomly replicate several parameterized requests to complete the preparation of a batch of requests. See the following example.</p><pre><code>  - request:
      method: POST
      has_variable: true
      basic_auth:
        username: test
        password: testtest
      url: http://localhost:8000/_bulk
      body_repeat_times: 1000
      body: &quot;{ \&quot;index\&quot; : { \&quot;_index\&quot; : \&quot;medcl-y4\&quot;,\&quot;_type\&quot;:\&quot;doc\&quot;, \&quot;_id\&quot; : \&quot;$[[uuid]]\&quot; } }\n{ \&quot;id\&quot; : \&quot;$[[id]]\&quot;,\&quot;field1\&quot; : \&quot;$[[user]]\&quot;,\&quot;ip\&quot; : \&quot;$[[ip]]\&quot;,\&quot;now_local\&quot; : \&quot;$[[now_local]]\&quot;,\&quot;now_unix\&quot; : \&quot;$[[now_unix]]\&quot; }\n&quot;
</code></pre><h3 id=limiting-the-client-workload>Limiting the Client Workload
<a class=anchor href=#limiting-the-client-workload>#</a></h3><p>You can use Loadgen and set the CLI parameter <code>-r</code> to restrict the number of requests that can be sent by the client per second, so as to evaluate the response time and load of Elasticsearch under fixed pressure. See the following example.</p><pre><code>➜  loadgen git:(master) ✗ ./bin/loadgen -d 30 -c 100 -r 100
</code></pre><blockquote><p>Note: The client throughput limit may not be accurate enough in the case of massive concurrencies.</p></blockquote><h3 id=limiting-the-total-number-of-requests>Limiting the Total Number of Requests
<a class=anchor href=#limiting-the-total-number-of-requests>#</a></h3><p>You can set the <code>-l</code> parameter to control the total number of requests that can be sent by the client, so as to generate a fixed number of documents. Modify the configuration as follows:</p><pre><code>requests:
  - request:
      method: POST
      has_variable: true
      basic_auth:
        username: test
        password: testtest
      url: http://localhost:8000/medcl-test/doc2/_bulk
      body_repeat_times: 1
      body: &quot;{ \&quot;index\&quot; : { \&quot;_index\&quot; : \&quot;medcl-test\&quot;, \&quot;_id\&quot; : \&quot;$[[uuid]]\&quot; } }\n{ \&quot;id\&quot; : \&quot;$[[id]]\&quot;,\&quot;field1\&quot; : \&quot;$[[user]]\&quot;,\&quot;ip\&quot; : \&quot;$[[ip]]\&quot; }\n&quot;
</code></pre><p>Configured parameters use the content of only one document for each request. Then, the system executes Loadgen.</p><pre><code>./bin/loadgen -config loadgen-gw.yml -d 600 -c 100 -l 50000
</code></pre><p>After execution, <code>50000</code> records are added for the Elasticsearch index <code>medcl-test</code>.</p><h3 id=using-auto-incremental-ids-to-ensure-the-document-sequence>Using Auto Incremental IDs to Ensure the Document Sequence
<a class=anchor href=#using-auto-incremental-ids-to-ensure-the-document-sequence>#</a></h3><p>If the IDs of generated documents need to increase regularly to facilitate comparison, you can use the auto incremental IDs of the <code>sequence</code> type as the primary key and avoid using random numbers in the content. See the following example.</p><pre><code>requests:
  - request:
      method: POST
      has_variable: true
      basic_auth:
        username: test
        password: testtest
      url: http://localhost:8000/medcl-test/doc2/_bulk
      body_repeat_times: 1
      body: &quot;{ \&quot;index\&quot; : { \&quot;_index\&quot; : \&quot;medcl-test\&quot;, \&quot;_id\&quot; : \&quot;$[[id]]\&quot; } }\n{ \&quot;id\&quot; : \&quot;$[[id]]\&quot; }\n&quot;
</code></pre></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div class=book-languages tabindex=0 aria-haspopup=true><ul><li class="flex align-center"><img src=/svg/translate.svg class=book-icon alt=Languages>
English</li></ul><ul class=book-languages-list><li><a href=/zh/docs/getting-started/benchmark/ class="flex align-center"><img src=/svg/translate.svg class=book-icon alt=Languages>
Chinese</a></li><li class=active><a href=/ class="flex align-center"><img src=/svg/translate.svg class=book-icon alt=Languages>
English</a></li></ul></div><div class="flex align-center footer">©INFINI.LTD, All Rights Reserved.</div><script>(function(h,o,t,j,a,r){h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};h._hjSettings={hjid:2567416,hjsv:6};a=o.getElementsByTagName('head')[0];r=o.createElement('script');r.async=1;r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;a.appendChild(r);})(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-VV6PGDHH84"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','G-VV6PGDHH84');</script><script type=text/javascript>var _smartsupp=_smartsupp||{};_smartsupp.key='691ff544d18a237005a011a7290b839d8fe811a4';window.smartsupp||(function(d){var s,c,o=smartsupp=function(){o._.push(arguments)};o._=[];s=d.getElementsByTagName('script')[0];c=d.createElement('script');c.type='text/javascript';c.charset='utf-8';c.async=true;c.src='https://www.smartsuppchat.com/loader.js?';s.parentNode.insertBefore(c,s);})(document);</script></div></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><nav id=TableOfContents><ul><li><a href=#performance-test>Performance Test</a><ul><li><a href=#loadgen>Loadgen</a><ul><li><a href=#use-of-variables>Use of Variables</a></li><li><a href=#request-definition>Request Definition</a></li><li><a href=#cli-parameters>CLI Parameters</a></li><li><a href=#benchmark-test>Benchmark Test</a></li><li><a href=#simulating-bulk-ingestion>Simulating Bulk Ingestion</a></li><li><a href=#limiting-the-client-workload>Limiting the Client Workload</a></li><li><a href=#limiting-the-total-number-of-requests>Limiting the Total Number of Requests</a></li><li><a href=#using-auto-incremental-ids-to-ensure-the-document-sequence>Using Auto Incremental IDs to Ensure the Document Sequence</a></li></ul></li></ul></li></ul></nav></aside></main></body></html>